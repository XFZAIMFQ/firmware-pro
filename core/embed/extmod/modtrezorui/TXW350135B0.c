#define USE_LINUX_MIPI_HDR

#include <TXW350135B0.h>

int TXW350135B0_init_sequence(DSI_Writer_t dsi_writter, Delay_ms_uint32 delay_ms)
{
    DSI_CMD(dsi_writter, 0xff, 0x77, 0x01, 0x00, 0x00, 0x13); // CND2BKxSEL select bank3 with cmd2
    DSI_CMD(dsi_writter, 0xef, 0x08);                         //?
    DSI_CMD(dsi_writter, 0xff, 0x77, 0x01, 0x00, 0x00, 0x10); // CND2BKxSEL select bank0 with cmd2
    DSI_CMD(dsi_writter, 0xc0, 0x63, 0x00); // LNESET LDE_EN=0, Line=99, NL= (Line+1)*8, Line_delta=0
    DSI_CMD(dsi_writter, 0xc1, 0x14, 0x0C); // PORCTRL VBP=20, VFP=12
    DSI_CMD(dsi_writter, 0xc2, 0x37, 0x02); // INVSET invert column, RTNI=12
    DSI_CMD(dsi_writter, 0xcc, 0x10);       // ?
    DSI_CMD(
        dsi_writter, 0xB0, 0x06, 0x10, 0x16, 0x0D, 0x11, 0x06, 0x08, 0x07, 0x08, 0x22, 0x04, 0x14, 0x0F, 0x29,
        0x2F,
        0x1F // PVGAMCTRL
    );
    DSI_CMD(dsi_writter, 0xB1, 0x0F, 0x18, 0x1E, 0x0C, 0x0F, 0x06, 0x08, 0x0A, 0x09, 0x24, 0x05, 0x10, 0x11, 0x2A,0x34,
        0x1F // NVGAMCTRL
    );
    DSI_CMD(dsi_writter, 0xff, 0x77, 0x01, 0x00, 0x00, 0x11); // CND2BKxSEL select bank1 with cmd2
    DSI_CMD(dsi_writter, 0xb0, 0x4D);                         // VRHS VRHA=77
    DSI_CMD(dsi_writter, 0xb1, 0x4D);                         // VCOMS VCOM=77
    DSI_CMD(dsi_writter, 0xb2, 0x81);                         // VGHSS VGHSS=12.0v
    // DSI_CMD(dsi_writter, 0xb3, 0x80);                         // TESTCMD
    // nothing
    DSI_CMD(dsi_writter, 0xb5, 0x4E); // VGLS VGLS=-12.2v
    DSI_CMD(dsi_writter, 0xb7, 0x85); // PWCTRL1 APOS=Min, APIS=Min, AP=Middle
    DSI_CMD(dsi_writter, 0xb8, 0x32); // PWCTRL2 AVCL=-4.8v, AVDD=6.8v
    DSI_CMD(dsi_writter, 0xBB, 0x03); // PCLKS2 SBSTCKS=10MHz
    DSI_CMD(dsi_writter, 0xc1, 0x08); // SPD1 T2D=1.6uS
    DSI_CMD(dsi_writter, 0xc2, 0x08); // SPD2 TD3=3.2uS
    DSI_CMD(dsi_writter, 0xd0, 0x88); // MIPISET1 EOT_EN=1, ERR_SEL=Disable

    DSI_CMD(dsi_writter, 0xe0, 0x00, 0x00, 0x02);                                                       // ?
    DSI_CMD(dsi_writter, 0xE1, 0x06, 0x28, 0x08, 0x28, 0x05, 0x28, 0x07, 0x28, 0x0E, 0x33, 0x33);       // ?
    DSI_CMD(dsi_writter, 0xE2, 0x30, 0x30, 0x33, 0x33, 0x34, 0x00, 0x00, 0x00, 0x34, 0x00, 0x00, 0x00); // ?
    DSI_CMD(dsi_writter, 0xe3, 0x00, 0x00, 0x33, 0x33);                                                 // ?
    DSI_CMD(dsi_writter, 0xe4, 0x44, 0x44);                                                             // ?
    DSI_CMD(dsi_writter, 
        // ?
        0xE5, 0x09, 0x2F, 0x2C, 0x8C, 0x0B, 0x31, 0x2C, 0x8C, 0x0D, 0x33, 0x2C, 0x8C, 0x0F, 0x35, 0x2C, 0x8C
    );
    DSI_CMD(dsi_writter, 0xE6, 0x00, 0x00, 0x33, 0x33); // ?
    DSI_CMD(dsi_writter, 0xE7, 0x44, 0x44);             // ?
    DSI_CMD(dsi_writter, // ?
        0xE8, 0x08, 0x2E, 0x2C, 0x8C, 0x0A, 0x30, 0x2C, 0x8C, 0x0C, 0x32, 0x2C, 0x8C, 0x0E, 0x34, 0x2C, 0x8C
    );
    DSI_CMD(dsi_writter, 0xE9, 0x36, 0x00);                               // ?
    DSI_CMD(dsi_writter, 0xEB, 0x00, 0x01, 0xE4, 0xE4, 0x44, 0x88, 0x40); // ?
    DSI_CMD(dsi_writter, 0xED, 0xFF, 0xFC, 0xB2, 0x45, 0x67, 0xFA, 0x01, 0xFF, 0xFF, 0x10, 0xAF, 0x76, 0x54, 0x2B,0xCF,0xFF);                                                              // ?
    DSI_CMD(dsi_writter, 0xef, 0x08, 0x08, 0x08, 0x45, 0x3f, 0x54); // ?

    DSI_CMD(dsi_writter, 0xff, 0x77, 0x01, 0x00, 0x00, 0x13); // CND2BKxSEL select bank3 with cmd2
    DSI_CMD(dsi_writter, 0xe8, 0x00, 0x0e);                   // ?
    DSI_CMD(dsi_writter, 0xff, 0x77, 0x01, 0x00, 0x00, 0x00); // CND2BKxSEL select bank0 without cmd2
    DSI_CMD(dsi_writter, MIPI_DCS_EXIT_SLEEP_MODE);           // SLPOUT
    HAL_Delay(120);                                           // delay
    DSI_CMD(dsi_writter, 0xff, 0x77, 0x01, 0x00, 0x00, 0x13); // CND2BKxSEL select bank3 with cmd2
    DSI_CMD(dsi_writter, 0xe8, 0x00, 0x0c);                   // ?
    HAL_Delay(10);                                            // delay
    DSI_CMD(dsi_writter, 0xe8, 0x00, 0x00);                   // ?
    DSI_CMD(dsi_writter, 0xff, 0x77, 0x01, 0x00, 0x00, 0x00); // CND2BKxSEL select bank0 without cmd2
    DSI_CMD(dsi_writter, 0x36,0xA0); // MADCTL normal scan, bgr->bgr
    // DSI_CMD(dsi_writter, 0x3a, 0x50);  // COLMOD 16bit color
    DSI_CMD(dsi_writter, MIPI_DCS_SET_TEAR_ON, 0x00);
    DSI_CMD(dsi_writter, MIPI_DCS_WRITE_CONTROL_DISPLAY, 0x2C);
    DSI_CMD(dsi_writter, MIPI_DCS_SET_PIXEL_FORMAT, 0x50);
    DSI_CMD(dsi_writter, MIPI_DCS_SET_DISPLAY_ON); // DISPON
    HAL_Delay(20);                                 // delay
    DSI_CMD(dsi_writter, 0xff, 0x77, 0x01, 0x00, 0x00,0x10);                          // CND2BKxSEL select bank1 with cmd2
    DSI_CMD(dsi_writter, 0xe5, 0x00, 0x00); // ?

    return 0;
}
