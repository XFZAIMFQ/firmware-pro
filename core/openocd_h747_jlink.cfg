# J-Link configuration for STM32H747
adapter driver jlink
adapter speed 4000

# STM32H747 specific settings
transport select swd
swd newdap stm32h7x cpu -irlen 4 -ircapture 0x1 -irmask 0xf
dap create stm32h7x.dap -chain-position stm32h7x.cpu

# Configure the Cortex-M7 core (main core)
target create stm32h7x.cpu0 cortex_m -endian little -dap stm32h7x.dap -ap-num 0
stm32h7x.cpu0 configure -work-area-phys 0x20000000 -work-area-size 0x8000 -work-area-backup 0

# Configure the Cortex-M4 core (secondary core) 
target create stm32h7x.cpu1 cortex_m -endian little -dap stm32h7x.dap -ap-num 3
stm32h7x.cpu1 configure -work-area-phys 0x10000000 -work-area-size 0x8000 -work-area-backup 0

# Flash configuration for dual bank
flash bank stm32h7x.bank1.cpu0 stm32h7x 0x08000000 0x100000 0 0 stm32h7x.cpu0
flash bank stm32h7x.bank2.cpu0 stm32h7x 0x08100000 0x100000 0 0 stm32h7x.cpu0

# Reset configuration
reset_config srst_only srst_nogate connect_assert_srst

# Target selection
targets stm32h7x.cpu0