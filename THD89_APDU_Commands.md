# THD89 APDU命令表

本文档列出了se_thd89.c中所有的APDU命令及其功能描述。

## APDU命令列表

| CLA | INS | P1 | P2 | 函数名 | 功能描述 |
|-----|-----|----|----|--------|----------|
| 0x00 | 0x84 | 0x00 | 0x00 | `se_get_rand_ex` | 获取随机数 |
| 0x00 | 0xF0 | 0x00 | 0x00 | `se_reset_se_ex` | 重置安全元件 |
| 0x00 | 0xF5 | 0x00 | 0x00 | `se_get_sn` | 获取序列号 |
| 0x00 | 0xF5 | 0x00 | 0x01 | `se_get_pubkey` | 获取公钥 |
| 0x00 | 0xF5 | 0x00 | 0x02 | `se_read_certificate` | 读取证书 |
| 0x00 | 0xF5 | 0x00 | 0x03 | `se_sign_message` | 签名消息 |
| 0x00 | 0xF5 | 0x00 | 0x04 | `se_sign_message_with_write_key` | 使用写入密钥签名消息 |
| 0x00 | 0xF5 | 0x00 | 0x05 | `se_get_ecdh_pubkey` | 获取ECDH公钥 |
| 0x00 | 0xF5 | 0x00 | 0x05 | `se_lock_ecdh_pubkey` | 锁定ECDH公钥 |
| 0x00 | 0xF6 | 0x00 | 0x00 | `se_set_sn` | 设置序列号 |
| 0x00 | 0xF6 | 0x00 | 0x01 | `se_write_certificate` | 写入证书 |
| 0x00 | 0xF6 | 0x00 | 0x02 | `se_set_session_key_ex` | 设置会话密钥 |
| 0x00 | 0xF6 | 0x00 | 0x03 | `se_set_private_key_extern` | 设置外部私钥 |
| 0x00 | 0xF7 | 0x00 | 0x00 | `se_get_version` | 获取版本 |
| 0x00 | 0xF7 | 0x00 | 0x01 | `se_get_build_id` | 获取构建ID |
| 0x00 | 0xF7 | 0x00 | 0x02 | `se_get_hash` | 获取哈希 |
| 0x00 | 0xF7 | 0x00 | 0x03 | `se_get_boot_version` | 获取引导版本 |
| 0x00 | 0xF7 | 0x00 | 0x04 | `se_get_boot_build_id` | 获取引导构建ID |
| 0x00 | 0xF7 | 0x00 | 0x05 | `se_get_boot_hash` | 获取引导哈希 |
| 0x00 | 0xF8 | 0x00 | 0x00 | `se_isInitialized` | 检查是否初始化 |
| 0x00 | 0xF9 | 0x00 | 0x00 | `se_gen_fido_seed` | 生成FIDO种子 |
| 0x00 | 0xF9 | 0x00 | 0x01 | `se_u2f_register` | U2F注册 |
| 0x00 | 0xF9 | 0x00 | 0x02 | `se_u2f_gen_handle_and_node` | U2F生成句柄和节点 |
| 0x00 | 0xF9 | 0x00 | 0x03 | `se_u2f_validate_handle` | U2F验证句柄 |
| 0x00 | 0xF9 | 0x00 | 0x04 | `se_u2f_authenticate` | U2F认证 |
| 0x00 | 0xF9 | 0x00 | 0x05 | `se_get_u2f_counter` | 获取U2F计数器 |
| 0x00 | 0xF9 | 0x00 | 0x07 | `se_set_u2f_counter` | 设置U2F计数器 |
| 0x00 | 0xF9 | 0x00 | 0x08 | `se_derive_fido_keys` | 派生FIDO密钥 |
| 0x00 | 0xF9 | 0x00 | 0x09 | `se_fido_hdnode_sign_digest` | FIDO HD节点签名摘要 |
| 0x00 | 0xF9 | 0x00 | 0x0A | `se_fido_att_sign_digest` | FIDO ATT签名摘要 |
| 0x00 | 0xFA | 0x00 | 0x00 | `se_sync_session_key_ex_old` | 同步会话密钥(旧版) |
| 0x00 | 0xFA | 0x00 | 0x00 | `se_sync_session_key_ex` | 同步会话密钥 |
| 0x80 | 0xE6 | 0x00 | 0x08 | `session_generate_seed_percent` | 获取种子生成进度(响应) |
| 0x84 | 0x84 | 0x00 | 0x00 | `se_random_encrypted` | 获取加密随机数 |
| 0x84 | 0xE1 | 0x00 | 0x00 | `se_reset_storage` | 重置存储 |
| 0x84 | 0xE2 | 0x00 | 0x00 | `se_set_mnemonic` | 设置助记词 |
| 0x84 | 0xE2 | 0x00 | 0x01 | `se_containsMnemonic` | 检查是否包含助记词 |
| 0x84 | 0xE2 | 0x00 | 0x02 | `se_exportMnemonic` | 导出助记词 |
| 0x84 | 0xE2 | 0x00 | 0x03 | `se_set_needs_backup` | 设置需要备份标志 |
| 0x84 | 0xE2 | 0x00 | 0x04 | `se_get_needs_backup` | 获取需要备份标志 |
| 0x84 | 0xE2 | 0x00 | 0x05 | `se_import_slip39` | 导入SLIP39 |
| 0x84 | 0xE3 | 0x00 | 0x00 | `se_get_public_region` | 获取公共区域数据 |
| 0x84 | 0xE3 | 0x00 | 0x01 | `se_get_private_region` | 获取私有区域数据 |
| 0x84 | 0xE3 | 0x00 | 0x02 | `se_fp_read` | 读取指纹数据 |
| 0x84 | 0xE3 | 0x00 | 0x03 | `se_get_fido2_data` | 获取FIDO2数据 |
| 0x84 | 0xE4 | 0x00 | 0x00 | `se_set_public_region` | 设置公共区域数据 |
| 0x84 | 0xE4 | 0x00 | 0x01 | `se_set_private_region` | 设置私有区域数据 |
| 0x84 | 0xE4 | 0x00 | 0x02 | `se_fp_write` | 写入指纹数据 |
| 0x84 | 0xE4 | 0x00 | 0x03 | `se_set_fido2_data` | 设置FIDO2数据 |
| 0x84 | 0xE4 | 0x00 | 0x04 | `se_delete_all_fido2_credentials` | 删除所有FIDO2凭据 |
| 0x84 | 0xE5 | 0x00 | 0x00 | `se_hasPin` | 检查是否有PIN |
| 0x84 | 0xE5 | 0x00 | 0x01 | `se_setPin` | 设置PIN |
| 0x84 | 0xE5 | 0x00 | 0x02 | `se_changePin` | 更改PIN |
| 0x84 | 0xE5 | 0x00 | 0x03 | `se_verifyPin` | 验证PIN |
| 0x84 | 0xE5 | 0x00 | 0x04 | `se_getSecsta` | 获取安全状态 |
| 0x84 | 0xE5 | 0x00 | 0x05 | `se_getRetryTimes` | 获取重试次数 |
| 0x84 | 0xE5 | 0x00 | 0x06 | `se_clearSecsta` | 清除安全状态 |
| 0x84 | 0xE5 | 0x00 | 0x07 | `se_hasWipeCode` | 检查是否有擦除码 |
| 0x84 | 0xE5 | 0x00 | 0x08 | `se_changeWipeCode` | 更改擦除码 |
| 0x84 | 0xE5 | 0x00 | 0x09 | `se_set_pin_passphrase` | 设置PIN口令 |
| 0x84 | 0xE5 | 0x00 | 0x0A | `se_delete_pin_passphrase` | 删除PIN口令 |
| 0x84 | 0xE5 | 0x00 | 0x0B | `se_check_passphrase_btc_test_address` | 检查口令BTC测试地址 |
| 0x84 | 0xE5 | 0x00 | 0x0C | `se_get_pin_passphrase_space` | 获取PIN口令空间 |
| 0x84 | 0xE5 | 0x00 | 0x0D | `se_set_pin_passphrase (check override)` | 检查PIN口令是否覆盖 |
| 0x84 | 0xE5 | 0x00 | 0x0E | `se_change_pin_passphrase` | 更改PIN口令 |
| 0x84 | 0xE6 | 0x00 | 0x00 | `se_sessionStart` | 开始会话 |
| 0x84 | 0xE6 | 0x00 | 0x01 | `se_sessionOpen` | 打开会话 |
| 0x84 | 0xE6 | 0x00 | 0x02 | `se_sessionClose` | 关闭会话 |
| 0x84 | 0xE6 | 0x00 | 0x03 | `se_sessionClear` | 清除会话 |
| 0x84 | 0xE6 | 0x00 | 0x04 | `se_get_session_seed_state` | 获取会话种子状态 |
| 0x84 | 0xE6 | 0x00 | 0x05 | `session_generate_master_seed` | 生成主种子 |
| 0x84 | 0xE6 | 0x00 | 0x06 | `session_generate_cardano_seed` | 生成Cardano种子 |
| 0x84 | 0xE6 | 0x00 | 0x07 | `se_session_is_open` | 检查会话是否打开 |
| 0x84 | 0xE6 | 0x00 | 0x08 | `session_generate_seed_percent` | 获取种子生成进度 |
| 0x84 | 0xE6 | 0x00 | 0x09 | `se_session_get_type` | 获取会话类型 |
| 0x84 | 0xE6 | 0x00 | 0x0A | `se_session_get_current_id` | 获取当前会话ID |
| 0x84 | 0xE7 | 0x00 | 0x00 | `se_derive_keys` | 派生密钥 |
| 0x84 | 0xE7 | 0x00 | 0x01 | `se_derive_xmr_key` | 派生XMR密钥 |
| 0x84 | 0xE7 | 0x00 | 0x02 | `se_derive_xmr_private_key` | 派生XMR私钥 |
| 0x84 | 0xE7 | 0x00 | 0x03 | `se_xmr_get_tx_key` | 获取XMR交易密钥 |
| 0x84 | 0xE8 | 0x00 | 0x00 | `se_node_sign_digest` | 节点签名摘要 |
| 0x84 | 0xE8 | 0x00 | 0x01 | `se_ecdsa_sign_digest` | ECDSA签名摘要 |
| 0x84 | 0xE8 | 0x00 | 0x02 | `se_ed25519_sign` | Ed25519签名 |
| 0x84 | 0xE8 | 0x00 | 0x03 | `se_ed25519_sign_ext` | Ed25519扩展签名 |
| 0x84 | 0xE8 | 0x00 | 0x04 | `se_ed25519_sign_keccak` | Ed25519 Keccak签名 |
| 0x84 | 0xE8 | 0x00 | 0x06 | `se_derive_tweak_private_keys` | 派生调整私钥 |
| 0x84 | 0xE8 | 0x00 | 0x07 | `se_bip340_sign_digest` | BIP340签名摘要 |
| 0x84 | 0xE8 | 0x00 | 0x08 | `_se_ed25519_sign_digest` | Ed25519签名摘要(内部) |
| 0x84 | 0xE8 | 0x00 | 0x09 | `se_bch_schnorr_sign_digest` | BCH Schnorr签名摘要 |
| 0x84 | 0xE9 | 0x00 | 0x00 | `se_ecdsa_ecdh` | ECDSA ECDH密钥交换 |
| 0x84 | 0xE9 | 0x00 | 0x01 | `se_curve25519_ecdh` | Curve25519 ECDH密钥交换 |
| 0x84 | 0xE9 | 0x00 | 0x02 | `se_lite_card_ecdh` | Lite卡ECDH密钥交换 |
| 0x84 | 0xEA | 0x00 | 0x00 | `se_aes256_encrypt` | AES256加密 |
| 0x84 | 0xEA | 0x00 | 0x01 | `se_aes256_decrypt` | AES256解密 |
| 0x84 | 0xEA | 0x00 | 0x02 | `se_nem_aes256_encrypt` | NEM AES256加密 |
| 0x84 | 0xEA | 0x00 | 0x03 | `se_nem_aes256_decrypt` | NEM AES256解密 |
| 0x84 | 0xEB | 0x00 | 0x00 | `se_slip21_node` | SLIP21节点派生 |
| 0x84 | 0xEB | 0x00 | 0x01 | `se_slip21_fido_node` | SLIP21 FIDO节点派生 |
| 0x84 | 0xEC | 0x00 | 0x00 | `se_authorization_set` | 设置授权 |
| 0x84 | 0xEC | 0x00 | 0x01 | `se_authorization_get_type` | 获取授权类型 |
| 0x84 | 0xEC | 0x00 | 0x02 | `se_authorization_get_data` | 获取授权数据 |
| 0x84 | 0xEC | 0x00 | 0x03 | `se_authorization_clear` | 清除授权 |
| 0x84 | 0xED | 0x00 | 0x00 | `_se_ed25519_send_msg` | Ed25519消息哈希更新 |
| 0x84 | 0xED | 0x00 | 0x40 | `_se_ed25519_send_msg` | Ed25519消息哈希初始化 |
| 0x84 | 0xED | 0x00 | 0x80 | `_se_ed25519_send_msg` | Ed25519消息哈希完成 |
| 0x84 | 0xED | 0x01 | 0x00 | `_se_ed25519_send_msg` | Ed25519扩展消息哈希更新 |
| 0x84 | 0xED | 0x01 | 0x40 | `_se_ed25519_send_msg` | Ed25519扩展消息哈希初始化 |
| 0x84 | 0xED | 0x01 | 0x80 | `_se_ed25519_send_msg` | Ed25519扩展消息哈希完成 |
| 0x84 | 0xED | 0x02 | 0x00 | `_se_ed25519_send_msg` | Ed25519 Keccak消息哈希更新 |
| 0x84 | 0xED | 0x02 | 0x40 | `_se_ed25519_send_msg` | Ed25519 Keccak消息哈希初始化 |
| 0x84 | 0xED | 0x02 | 0x80 | `_se_ed25519_send_msg` | Ed25519 Keccak消息哈希完成 |
| 0x84 | 0xEE | 0x00 | 0x00 | `_se_ed25519_send_msg` | Ed25519 RAM哈希更新 |
| 0x84 | 0xEE | 0x00 | 0x40 | `_se_ed25519_send_msg` | Ed25519 RAM哈希初始化 |
| 0x84 | 0xEE | 0x00 | 0x80 | `_se_ed25519_send_msg` | Ed25519 RAM哈希完成 |
| 0x84 | 0xEE | 0x01 | 0x00 | `_se_ed25519_send_msg` | Ed25519扩展RAM哈希更新 |
| 0x84 | 0xEE | 0x01 | 0x40 | `_se_ed25519_send_msg` | Ed25519扩展RAM哈希初始化 |
| 0x84 | 0xEE | 0x01 | 0x80 | `_se_ed25519_send_msg` | Ed25519扩展RAM哈希完成 |
| 0x84 | 0xEE | 0x02 | 0x00 | `_se_ed25519_send_msg` | Ed25519 Keccak RAM哈希更新 |
| 0x84 | 0xEE | 0x02 | 0x40 | `_se_ed25519_send_msg` | Ed25519 Keccak RAM哈希初始化 |
| 0x84 | 0xEE | 0x02 | 0x80 | `_se_ed25519_send_msg` | Ed25519 Keccak RAM哈希完成 |
| 0x84 | 0xEF | 0x00 | 0x00 | `se_fingerprint_state` | 获取指纹状态 |
| 0x84 | 0xEF | 0x00 | 0x01 | `se_fingerprint_lock` | 锁定指纹 |
| 0x84 | 0xEF | 0x00 | 0x02 | `se_fingerprint_unlock` | 解锁指纹 |
| 0xA4 | 0x84 | 0x00 | 0x00 | `se_random_encrypted_ex` | 获取加密随机数(扩展) |

**总计:** 124 条APDU命令

## 指令类别统计

| INS | 指令数量 | 说明 |
|-----|---------|------|
| 0x84 | 3 | 随机数生成 |
| 0xE1 | 1 | 存储重置 |
| 0xE2 | 6 | 助记词管理 |
| 0xE3 | 4 | 数据读取 |
| 0xE4 | 5 | 数据写入 |
| 0xE5 | 15 | PIN管理 |
| 0xE6 | 12 | 会话管理 |
| 0xE7 | 4 | 密钥派生 |
| 0xE8 | 9 | 签名操作 |
| 0xE9 | 3 | ECDH密钥交换 |
| 0xEA | 4 | AES加密解密 |
| 0xEB | 2 | SLIP21派生 |
| 0xEC | 4 | CoinJoin授权 |
| 0xED | 9 | 消息哈希 |
| 0xEE | 9 | RAM哈希 |
| 0xEF | 3 | 指纹管理 |
| 0xF0 | 1 | 设备重置 |
| 0xF5 | 7 | 查询操作 |
| 0xF6 | 4 | 设置操作 |
| 0xF7 | 6 | 版本信息 |
| 0xF8 | 1 | 状态查询 |
| 0xF9 | 10 | FIDO操作 |
| 0xFA | 2 | 密钥同步 |

## CLA分类

- **0x00**: 标准APDU命令(无MAC保护)
- **0x84**: 加密APDU命令(带MAC保护)
- **0xA4**: 扩展加密命令
- **0x80**: 响应类命令

## 使用说明

1. **CLA (Class Byte)**: 命令类别字节
   - 0x00: 标准命令,用于设备初始化和基本查询
   - 0x84: 加密命令,所有敏感操作都使用此类别,提供MAC保护
   - 0xA4: 扩展加密命令
   - 0x80: 响应类命令

2. **INS (Instruction Byte)**: 指令字节,定义具体操作类型

3. **P1, P2 (Parameter Bytes)**: 参数字节,用于指定操作的具体子功能

4. **函数名**: 在se_thd89.c中实现该APDU命令的函数

5. **功能描述**: 该APDU命令的功能说明

---
*注: 此表格根据se_thd89.c代码自动生成,确保准确性用于芯片替代开发参考。*
